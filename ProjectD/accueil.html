<div id="Doom">
	<h1>Project D</h1>
	<!--input type="file" name="ressources" id="inputRessources" /-->

	<!--input id="clickMe" type="button" value="clickme" onclick="doFunction();" /-->
	<ul class="menu" id="menu1">
			<li class="bouton"><a onclick="jmenu2();">Jouer</a></li>
			<li class="bouton"><a onclick="jmenu3();">Option</a></li>
	</ul>
	<ul class="menu" id="menu2">
		<li><input type="file" name="ressources" id="inputRessources" /></li>
		<li class="bouton"><a onclick="jmenu1();">Retour</a></li>
	</ul>
	<ul class="menu" id="menu3">
		<li class="bouton"><a onclick="">Volume - musique</a></li>
		<li class="bouton"><a onclick="">Volume - validation</a></li>
		<li class="bouton"><a onclick="jmenu1();">Retour</a></li>
	</ul>

	<script>
		$("#inputRessources").change(function(){
			console.log($("#inputRessources")[0].files[0]);
			lireZip();
		});

		//function doFunction(){
			//$( "#Doom" ).load( "game.html" );
		//}
		function jmenu1(){
			document.getElementById("menu1").style.display="block";
			document.getElementById("menu2").style.display="none";
			document.getElementById("menu3").style.display="none";
		};
		function jmenu2(){
			document.getElementById("menu1").style.display="none";
			document.getElementById("menu2").style.display="block";
		};
		function jmenu3(){
			document.getElementById("menu1").style.display="none";
			document.getElementById("menu3").style.display="block";
		};
		//var blob;
		
		function afficherBoutonLancement()
		{
			$("#Doom").append('<input id="lancement" type="button" value="Commencer" onclick="lancerJeu();" />');
		}
		
		function lancerJeu()
		{
			//console.log(blob.mozFullPath);
		
			$( "#Doom" ).load( "game.html" );
			//chargement(blob);
		}
		
		zip.workerScriptsPath = "lib/";
		
		/* lecture de l'archive .zip de ressources fournie par l'utilisateur */
		function lireZip()
		{
			var blob = $("#inputRessources")[0].files[0]; // récupération du fichier sélectionné dans le formulaire
			let fichierValide = false;
						
			if ( blob.name.endsWith(".zip") ) // s'il s'agit bien d'une archive .zip
			{		
				zip.createReader(new zip.BlobReader(blob),function(reader)
				{
					reader.getEntries(function(entries)
					{
						if (entries.length) // s'il y a au moins un fichier dans l'archive
						{
							let entryBeatmap, entryAudio, entryVideo;
							
							//entries.forEach(function(entry) // pour chaque fichier contenu dans l'archive
							//{
								//if ( entry.filename.endsWith("beatmap.json")
								
							/* identification des différents fichiers de l'archive */
							for ( var i = 0 ; i < entries.length ; i++ ) // pour chaque fichier contenu dans l'archive
							{
								if ( entries[i].filename.endsWith("beatmap.json") )
									entryBeatmap = entries[i];
								else if ( entries[i].filename.endsWith(".mp3") )
									entryAudio = entries[i];
								else if ( entries[i].filename.endsWith(".mp4") )
									entryVideo = entries[i];
							}
							
							/* vérification de la présence du fichier beatmap.json, du son et de la vidéo */
							if ( entryBeatmap != null && entryAudio != null && entryVideo != null )
							{
								console.log("aaa");
							
								/* récupération du contenu des fichiers sous forme de Blobs */
																
								entryBeatmap.getData(new zip.BlobWriter(),function(blob1)
								{
									jsonBeatmap = blob1;
									console.log("jsonBeatmap accueil.html "+jsonBeatmap);
									
									entryAudio.getData(new zip.BlobWriter(),function(blob2)
									{
										blobAudio = blob2;
										console.log("blobAudio accueil.html "+blobAudio);
										
										entryVideo.getData(new zip.BlobWriter(),function(blob3)
										{
											blobVideo = blob3;
											console.log("blobVideo accueil.html "+blobVideo);
											
											fichierValide = true;
											
											reader.close(function() // après la lecture du contenu de l'archive
											{
												console.log(fichierValide);
							
												/* redirection vers le jeu si le fichier fourni est valide */
												if ( fichierValide )
													afficherBoutonLancement();
								
												// TODO Transmettre chemin des ressources vers script.js (fonction de chargement)
											});
										});
									});
								});
							}
									
							/*												
							entries[0].getData(new zip.BlobWriter(),function(blob)
							{
								//console.log(text);
								jsonBeatmap = blob;
								
								console.log("jsonBeatmap accueil.html "+jsonBeatmap);
								
								console.log(file);
							});
							*/
						
							/*entries.forEach(function(entry) // pour chaque fichier contenu dans l'archive
							{
								console.log(entry.filename);
								
								if ( entry.filename.endsWith("beatmap.json") )
								{
									console.log("a");
								
									entry.getData(new zip.TextWriter(),function(text)
									{
										//console.log(text);
										jsonBeatmap = text;
										console.log("jsonBeatmap accueil.html "+jsonBeatmap);
									});
									
									var file;
									entry.getData(new zip.BlobWriter(),function(blob)
									{
										//console.log(text);
										jsonBeatmap = blob;
										
										console.log("jsonBeatmap accueil.html "+jsonBeatmap);
										console.log(jsonBeatmap);
										
										console.log(file);
									});
								}*/
								
								/* vérification de la présence du fichier beatmap.json */
								//if ( !fichierValide && entry.filename.endsWith("beatmap.json") )
									//fichierValide = true;
							//});
						}
					});
				},
				function(error){});
			}
			
			return fichierValide;
		};
		
		/*//- Using a function pointer:
		document.getElementById("clickMe").onclick = doFunction;

		//- Using an anonymous function:
		document.getElementById("clickMe").onclick = function () { $( "#Doom" ).load( "game.html" ); };*/
	</script>
</div>
